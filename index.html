<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Silent Cinematic Story Engine v2</title>
  <style>
    :root { --pad: 14px; --r: 14px; --bg:#0b0d12; --fg:#eef2ff; --mut:rgba(255,255,255,.75); --bd:rgba(255,255,255,.12); }
    body{font-family:system-ui,-apple-system,sans-serif;margin:0;background:var(--bg);color:var(--fg);line-height:1.4}
    header{padding:22px 18px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(135deg, rgba(99,102,241,.15), rgba(16,185,129,.1));}
    header h1{margin:0 0 6px;font-size:22px}
    header p{margin:0;opacity:.85;font-size: 14px}
    main{max-width:1200px;margin:0 auto;padding:18px;display:grid;gap:16px}
    .grid{display:grid;gap:16px;grid-template-columns:1fr}
    @media (min-width:980px){ .grid{grid-template-columns:480px 1fr} }
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.10);border-radius:var(--r);padding:16px}
    .card h2{margin:0 0 10px;font-size:15px;text-transform:uppercase;letter-spacing:1px;color:#a5b4fc}
    label{font-size:11px;font-weight:bold;text-transform:uppercase;opacity:.7;display:block;margin:12px 0 4px}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.35);color:var(--fg);outline:none;box-sizing:border-box}
    .btnbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    button{border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:var(--fg);padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:700;transition:0.2s}
    button.primary{background:rgba(99,102,241,.3);border-color:rgba(99,102,241,.5)}
    button:hover{background:rgba(255,255,255,.12)}
    .out{white-space:pre-wrap;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:16px;font-size:13px;min-height:400px;font-family: monospace}
    .hr{height:1px;background:rgba(255,255,255,.10);margin:16px 0}
  </style>
</head>

<body>
  <header>
    <h1>Silent Cinematic Story Engine v2</h1>
    <p>Consistency Focused: Triad-Lock logic for logical, emotional, and visual storytelling.</p>
  </header>

  <main class="grid">
    <section class="card">
      <h2>1) Configuration</h2>
      <label>Seed</label>
      <input id="seed" value="willy-001" />

      <label>Story Tone</label>
      <select id="storyType"></select>

      <div class="hr"></div>

      <label>Problem (The Conflict)</label>
      <select id="problem"></select>

      <label>Primary Helper</label>
      <select id="helperRole"></select>

      <label>Location</label>
      <select id="location"></select>

      <div class="btnbar">
        <button class="primary" id="btn15">Generate 15 Scenes</button>
      </div>
    </section>

    <section class="card">
      <h2>2) Logic-Corrected Output</h2>
      <div class="btnbar" style="margin-bottom: 10px;">
        <button id="copyStory">Copy Text</button>
      </div>
      <div id="out" class="out">Click Generate to begin...</div>
    </section>
  </main>

<script>
/* --- UTILITIES --- */
function xmur3(str){for(var i=0,h=1779033703^str.length;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353); h=h<<13|h>>>19;}return function(){h=Math.imul(h^h>>>16,2246822507);h=Math.imul(h^h>>>13,3266489909);return (h^h>>>16)>>>0;}}
function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296;}}
function pick(rng, arr){ return arr[Math.floor(rng()*arr.length)] }

/* --- DATA LIBRARIES --- */
const PROBLEMS = [
  "A toy boat is stuck in thick reeds",
  "A wheel has popped off the wagon",
  "A heavy branch blocks the path",
  "A kite string is tangled high up",
  "A bridge plank is missing"
];

const ROLES = {
  "Mechanic": { animal: "Red Panda", tool: "mini silver wrench", action: "tightens the bolt", approach: "inspects the gears" },
  "Carpenter": { animal: "Beaver", tool: "small wooden mallet", action: "taps the wood into place", approach: "measures the gap" },
  "Lifeguard": { animal: "Otter", tool: "bright orange rescue float", action: "gently pulls the object to shore", approach: "watches the water" },
  "Ranger": { animal: "Fox", tool: "miniature rope coil", action: "loops the rope securely", approach: "scouts the obstacle" }
};

const LOCATIONS = [
  "Sunny Meadow with tall grass",
  "Quiet Riverbank with smooth stones",
  "Shadowy Forest with mossy logs",
  "Cozy Workshop with warm lanterns"
];

/* --- THE NARRATIVE ENGINE --- */
function generateStory(sceneCount) {
  const seedIn = document.getElementById("seed");
  const hash = xmur3(seedIn.value)();
  const rng = mulberry32(hash);

  // 1. Pick Logic State
  const problem = document.getElementById("problem").value;
  const roleKey = document.getElementById("helperRole").value;
  const role = ROLES[roleKey];
  const loc = document.getElementById("location").value;
  const tone = document.getElementById("storyType").value;

  // 2. Build the Arc (Logical Flow)
  const scenes = [
    `Scene 1: ${loc}. Willy (Baby Golden Retriever) sits quietly. His tiny pink blep is visible. He looks at his favorite toy nearby.`,
    `Scene 2: Willy tries to move toward the toy, but he stops. The atmosphere shifts.`,
    `Scene 3: Close-up on the conflict: ${problem}. It looks impossible for a small puppy to fix alone.`,
    `Scene 4: Willy’s ears droop. He lets out a tiny, silent sigh, looking down at his paws. (Emotional beat).`,
    `Scene 5: Movement in the background. ${role.animal} enters the frame, carrying a calm and confident energy.`,
    `Scene 6: ${role.animal} (the ${roleKey}) stops next to Willy. They share a brief, silent look of understanding.`,
    `Scene 7: ${role.animal} moves toward the problem and ${role.approach}. He knows exactly what to do.`,
    `Scene 8: ${role.animal} produces a ${role.tool}. The material looks photorealistic and heavy.`,
    `Scene 9: First Attempt: ${role.animal} uses the ${role.tool} to try and fix the ${problem}. It budges slightly but stays stuck.`,
    `Scene 10: Willy tilts his head, watching intently. His tail gives a single, hopeful wag. (Consistency beat).`,
    `Scene 11: The Adjustment: ${role.animal} changes his grip on the ${role.tool}, showing a clever, slow movement.`,
    `Scene 12: Success! With a final purposeful ${role.action}, the ${problem} is solved.`,
    `Scene 13: Willy’s tail starts wagging rapidly. He nudges the ${role.animal}’s shoulder gently in thanks.`,
    `Scene 14: The two friends stand side-by-side, looking at the fixed path. The lighting warms up (Golden Hour).`,
    `Scene 15: Calm closing echo. Willy sits in the same spot as Scene 1, but now he is happy and the path is clear.`
  ];

  // Output formatting
  let output = `STORY TITLE: Willy and the ${roleKey}'s Great Help\n`;
  output += `TONE: ${tone}\n`;
  output += `HELPER: ${role.animal} (${roleKey})\n`;
  output += `TOOL DNA: ${role.tool}\n`;
  output += `-------------------------------------------\n\n`;
  output += scenes.join("\n\n");

  document.getElementById("out").textContent = output;
  
  // Auto-increment seed
  seedIn.value = "willy-" + (Math.floor(rng() * 999));
}

/* --- UI INITIALIZATION --- */
function init() {
  const typeSel = document.getElementById("storyType");
  ["Gentle Adventure", "Funny Mishap", "Heartfelt Discovery"].forEach(t => {
    let o = document.createElement("option"); o.text = t; typeSel.add(o);
  });

  const probSel = document.getElementById("problem");
  PROBLEMS.forEach(p => {
    let o = document.createElement("option"); o.text = p; probSel.add(o);
  });

  const roleSel = document.getElementById("helperRole");
  Object.keys(ROLES).forEach(r => {
    let o = document.createElement("option"); o.text = r; roleSel.add(o);
  });

  const locSel = document.getElementById("location");
  LOCATIONS.forEach(l => {
    let o = document.createElement("option"); o.text = l; locSel.add(o);
  });

  document.getElementById("btn15").onclick = () => generateStory(15);
  document.getElementById("copyStory").onclick = () => {
    navigator.clipboard.writeText(document.getElementById("out").textContent);
    alert("Copied!");
  };
}

init();
</script>
</body>
</html>
