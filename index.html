<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Silent Story Generator ‚Äî Master Edition</title>
  <style>
    :root { --pad: 14px; --bg:#0b0d12; --fg:#eef2ff; --bd:rgba(255,255,255,.12); }
    body{font-family:system-ui,-apple-system,sans-serif;margin:0;background:var(--bg);color:var(--fg);line-height:1.4}
    header{padding:22px;border-bottom:1px solid var(--bd);background:linear-gradient(135deg, rgba(99,102,241,.15), rgba(16,185,129,.1));}
    main{max-width:1200px;margin:0 auto;padding:20px;display:grid;gap:20px;grid-template-columns:1fr}
    @media (min-width:980px){ .grid{grid-template-columns:480px 1fr} }
    .card{background:rgba(255,255,255,0.04);border:1px solid var(--bd);border-radius:14px;padding:20px}
    label{font-size:11px;font-weight:bold;text-transform:uppercase;opacity:0.7;display:block;margin:12px 0 4px}
    select, input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--bd);background:rgba(0,0,0,0.35);color:#fff;box-sizing:border-box}
    .btnbar{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}
    button{padding:12px 18px;border-radius:10px;border:none;cursor:pointer;font-weight:800;transition:0.2s}
    .primary{background:#6366f1;color:#fff}
    .secondary{background:rgba(16,185,129,0.2);color:#34d399;border:1px solid rgba(16,185,129,0.4)}
    .out{white-space:pre-wrap;background:rgba(0,0,0,0.5);border-radius:12px;padding:20px;font-size:13px;font-family:monospace;min-height:500px}
  </style>
</head>
<body>
  <header><h1>üêæ Willy's Silent Story Generator</h1></header>
  <main class="grid">
    <section class="card">
      <h2>1) Configuration</h2>
      <label>Seed (Auto-Increments)</label><input id="seed" value="willy-001" />
      <label>Location</label><select id="loc"></select>
      <label>Weather</label><select id="weather"></select>
      <label>Problem</label><select id="prob"></select>
      <label>Helper Role</label><select id="role"></select>
      <div class="btnbar">
        <button class="primary" id="genBtn">Create Story</button>
        <button class="secondary" id="compBtn">üöÄ Send to Compiler ‚Üí</button>
      </div>
    </section>
    <section class="card">
      <h2>2) Story Output</h2>
      <div id="out" class="out">Click "Create Story" to begin...</div>
    </section>
  </main>

<script>
/* RNG ENGINE */
const xmur3=s=>{let h=1779033703^s.length;for(let i=0;i<s.length;i++)h=Math.imul(h^s.charCodeAt(i),3432918353),h=h<<13|h>>>19;return()=>(h=Math.imul(h^h>>>16,2246822507),h=Math.imul(h^h>>>13,3266489909),(h^h>>>16)>>>0)};
const mul32=a=>()=>(let t=a+=0x6D2B79F5,t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),(t^t>>>14)>>>0)/4294967296;

/* MASTER LIBRARIES */
const LOCS = ["Sunny Meadow", "Riverside Stones", "Autumn Forest Trail", "Snowy Garden", "Cozy Workshop", "Indoor Playroom"];
const WEATHERS = ["Golden Hour Sunlight", "Morning Mist", "Soft Rain", "Pale Winter Dawn", "Cozy Indoor Lamp-light"];
const PROBLEMS = [
  "A toy boat is stuck in reeds", "A wheel fell off a wagon", "A branch blocks the path", 
  "A kite is tangled in a tree", "A bridge plank is missing", "A plush toy is stuck high up",
  "A wagon is stuck in deep mud", "A lantern tipped over", "A paper boat is folding wrong"
];
const ROLES = {
  "Mechanic": { animal: "Red Panda", tool: "Silver Wrench", vehicle: "Mini Tool Cart", action: "tightens the bolt" },
  "Carpenter": { animal: "Beaver", tool: "Wooden Mallet", vehicle: "Plank Carrier", action: "taps the wood flush" },
  "Lifeguard": { animal: "Otter", tool: "Rescue Hook", vehicle: "Small Floating Dock", action: "pulls it to shore" },
  "Ranger": { animal: "Fox", tool: "Hemp Rope", vehicle: "Gear Sled", action: "loops the knot securely" }
};

function init() {
  const f=(id,arr)=>arr.forEach(v=>{let o=document.createElement("option");o.text=v;document.getElementById(id).add(o)});
  f("loc", LOCS); f("weather", WEATHERS); f("prob", PROBLEMS);
  Object.keys(ROLES).forEach(r=>{let o=document.createElement("option");o.text=r;document.getElementById("role").add(o)});
}

document.getElementById("genBtn").onclick = () => {
  const seedEl = document.getElementById("seed");
  const rng = mul32(xmur3(seedEl.value)())();
  const loc = document.getElementById("loc").value;
  const weather = document.getElementById("weather").value;
  const prob = document.getElementById("prob").value;
  const roleKey = document.getElementById("role").value;
  const r = ROLES[roleKey];

  const story = `[VISUAL DNA]
WILLY: Golden Retriever puppy, red collar, pink blep tongue.
HELPER: ${r.animal}, realistic fur, no clothes.
TOOL DNA: ${r.tool} (toy-scale, matte).
VEHICLE DNA: ${r.vehicle} (realistic rolling physics).

[STORY SETTINGS]
Location: ${loc}
Weather: ${weather}
Problem: ${prob}

[SCENES]
Scene 1: ${loc} under ${weather}. Willy sits calmly, tiny blep visible.
Scene 2: Willy spots the ${prob.toLowerCase()}. He trots over.
Scene 3: Willy tries to help, but the ${prob.toLowerCase()} is too much for him.
Scene 4: Willy's ears droop. He looks worried. (Emotional beat).
Scene 5: ${r.animal} (the ${roleKey}) arrives, pushing the ${r.vehicle}.
Scene 6: Close-up: ${r.animal} gives Willy a slow, reassuring nod.
Scene 7: ${r.animal} opens the ${r.vehicle} and takes out the ${r.tool}.
Scene 8: ${r.animal} inspects the ${prob.toLowerCase()} with professional focus.
Scene 9: Attempt 1: ${r.animal} tries to ${r.action}. It moves slightly.
Scene 10: Willy watches with hopeful eyes, one ear twitching.
Scene 11: The Adjustment: ${r.animal} shifts stance for better leverage.
Scene 12: Success! With a final motion, the ${r.animal} ${r.action}.
Scene 13: Willy lets out a happy tail wag and nudges the ${r.animal}.
Scene 14: The two friends stand together, problem solved.
Scene 15: Peaceful closing echo. Willy is happy in the ${loc}.`;

  document.getElementById("out").textContent = story;
  seedEl.value = "willy-" + Math.floor(Math.random()*999);
};

document.getElementById("compBtn").onclick = () => {
  const s = document.getElementById("out").textContent;
  if(s.includes("Click")) return alert("Generate a story first!");
  localStorage.setItem("pendingStory", s);
  window.location.href = "compiler.html";
};

init();
</script>
</body>
</html>
